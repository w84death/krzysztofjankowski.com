<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="favicon.png" type="image/png" />
    <link rel="stylesheet" href="style.css" />

    <title>
      FLOPPINUX - An Embedded üêßLinux on a Single üíæFloppy - 2025 Edition
      (v0.3.0)
    </title>
  </head>
  <body>
    <main>
      <header>
        <h1>FLOPPINUX</h1>
        <h2>An Embedded üêßLinux on a Single üíæFloppy</h2>
        <h2>2025 Edition (v0.3.0)</h2>
        <p></p>
        <nav>
          <span>October 19, 2025</span> | <a href="/floppinux/">back to home</a>
        </nav>
      </header>

      <blockquote>
        FLOPPINUX was
        <a href="floppinux-an-embedded-linux-on-a-single-floppy.html"
          >released in 2021</a
        >. After four years people find it helpful. Because of that I decided to
        revisit FLOPPINUX in 2025 and make updated tutorial. This brings bunch
        of updates like latest kernel and persistent storage.
      </blockquote>

      <h2>Table of Contents</h2>
      <ul>
        <li><a href="#main-project-goals">Main Project Goals</a></li>
        <li><a href="#epub">EPUB/PDF</a></li>
        <li><a href="#linux-kernel">Linux Kernel</a></li>
        <li><a href="#64-bit-base-os">64-bit Base OS</a></li>
        <li><a href="#working-directory">Working Directory</a></li>
        <li><a href="#system-requirements">System Requirements</a></li>
        <li><a href="#kernel">Kernel</a></li>
        <li><a href="#toolset">Toolset</a></li>
        <li><a href="#filesystem">Filesystem</a></li>
        <li><a href="#boot-image">Boot Image</a></li>
        <li><a href="#floppy-disk">Floppy Disk</a></li>
        <li><a href="#summary">Summary</a></li>
        <li><a href="#download">Download</a></li>
      </ul>

      <h2 id="main-project-goals">Main Project Goals</h2>
      <p>
        Think of this as Linux From Scratch but for making single floppy
        distribution.
      </p>
      <blockquote>
        It is meant to be a full workshop (tutorial) that you can follow easily
        and modify it to your needs. It is a learning exercise. Some base Linux
        knowledge is needed.
      </blockquote>
      <p>
        The final distribution is very simple and consists only of minimum of
        tools and hardware support. As a user you will be able to boot any PC
        with a floppy drive to a Linux terminal, edit files, and create simple
        scripts. There is 264KB of space left for your newly created files.
      </p>
      <h3>Core features:</h3>
      <ul>
        <li>Fully working distribution booting from the single floppy</li>
        <li>Latest* Linux kernel</li>
        <li>Supporting all 32-bit x86 CPUs since Intel 486DX</li>
        <li>
          Have a working text editor (Vi) and basic file manipulation commands
          (move, rename, delete, etc.)
        </li>
        <li>Support for simple scripting</li>
        <li>Persistent storage on the floppy to actualy save files (264KB)</li>
        <li>Works on real hardware and emulation</li>
      </ul>
      <p><small>* latest kernel that supports Intel 486 CPUs</small></p>

      <h3>Minimum Hardware Requirements:</h3>
      <ul>
        <li>Intel 486DX 33MHz</li>
        <li>20MB RAM</li>
        <li>Internal floppy disk</li>
      </ul>

      <h2 id="epub">EPUB/PDF</h2>
      <p>
        This workshop is available in many formats including EPUB. Put it on
        your favorite eBook reader for better reading experience.
      </p>
      <ul>
        <li>
          EPUB: <a href="content/manuals/floppinux.epub">Download 15KiB</a>
        </li>
        <li>
          PDF: <a href="content/manuals/floppinux.pdf">Download 241KiB</a>
        </li>
      </ul>

      <h2 id="linux-kernel">Linux Kernel</h2>
      <p>
        The Linux kernel drops i486 support in 6.15 (released May 2025), so
        <strong>6.14</strong>
        (released March 2025) is the latest version with full compatibility.
      </p>

      <h2 id="64-bit-base-os">64-bit Base OS</h2>
      <p>
        This time I will do everything on <strong>Omarchy</strong> Linux. It is
        64-bit operating system based on Arch Linux. Instructions should work on
        all POSIX systems. Only difference is getting needed packages.
      </p>

      <h2 id="working-directory">Working Directory</h2>
      <p>Create directory where you will keep all the files.</p>
      <pre><code>mkdir ~/my-linux-distro/
BASE=~/my-linux-distro/
cd $BASE</code></pre>

      <h2 id="system-requirements">Host OS Requirements</h2>
      <blockquote>
        You need supporting software to build things. This exact list may vary
        depending on the system you have.
      </blockquote>
      <p>Install needed software/libs. On Arch/Omarchy 3.1:</p>
      <pre><code>sudo pacman -S ncurses bc flex bison syslinux cpio</code></pre>
      <p>Cross-compiler:</p>
      <pre><code>wget https://musl.cc/i486-linux-musl-cross.tgz
      tar xvf i486-linux-musl-cross.tgz</code></pre>

      <h3>Emulation</h3>
      <blockquote>
        86Box is also good but slower. Bochs is the best but for debugging, not
        needed here.
      </blockquote>
      <p>For emulation I will be using qemu.</p>
      <pre><code>sudo pacman -S qemu-full</code></pre>

      <h2 id="kernel">Kernel</h2>
      <p>Get the sources for the latest compatible kernel 6.14.11:</p>
      <pre><code>git clone --depth=1 --branch v6.14.y https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git
cd linux
</code></pre>
      <p>
        Now, that you have them in <strong>linux/</strong> directory lets
        configure and build our custom kernel. First create tiniest base
        configuration:
      </p>
      <pre><code>make ARCH=x86 tinyconfig</code></pre>
      <blockquote>
        This is a bootstrap with absolute minimum features. Just enough to boot
        the system. We want a little bit more.
      </blockquote>
      <p>Add additonal config settings on top of it:</p>
      <pre><code>make ARCH=x86 menuconfig</code></pre>
      <p>From menus choose those options:</p>
      <ul>
        <li>
          Processor type and features
          <ul>
            <li>x86 CPU resources control support</li>
            <li>
              Processor family
              <ul>
                <li>486DX</li>
              </ul>
            </li>
          </ul>
        </li>
        <li>Enable the block layer</li>
        <li>
          Device Drivers
          <ul>
            <li>
              Block devices
              <ul>
                <li>Normal floppydisk support</li>
                <li>RAM block device support (1 partition)</li>
              </ul>
            </li>
            <li>
              Character devices
              <ul>
                <li>Enable TTY</li>
              </ul>
            </li>
          </ul>
        </li>
        <li>
          General Setup
          <ul>
            <li>
              Configure standard kernel features (expert users)
              <ul>
                <li>Enable support for printk</li>
              </ul>
            </li>
            <li>Initial RAM filesystem and RAM disk (initramfs/initrd)</li>
            <li>
              Support initial ramdisk/ramfs compressed using XZ and uncheck
              everything else
            </li>
          </ul>
        </li>
        <li>
          Executable file formats
          <ul>
            <li>Kernel support for ELF binaries</li>
            <li>Kernel support for scripts starting with #!</li>
          </ul>
        </li>
        <li>
          File systems
          <ul>
            <li>
              DOS/FAT/EXFAT/NT Filesystems
              <ul>
                <li>MSDOS fs support</li>
              </ul>
            </li>
            <li>
              Pseudo filesystems
              <ul>
                <li>sysfs file system support</li>
              </ul>
            </li>
            <li>
              Native language support
              <ul>
                <li>Codepage 437</li>
              </ul>
            </li>
          </ul>
        </li>
        <li>
          Library routines
          <ul>
            <li>XZ decompression and uncheck everything else</li>
          </ul>
        </li>
      </ul>
      <p>Exit configuration (yes, save settings to .config).</p>
      <p>Time for compiling!</p>

      <h3>Compile Kernel</h3>
      <pre><code>make ARCH=x86 bzImage -j$(nproc)</code></pre>
      <p>
        This will take a while depending on the speed of your CPU. In the end
        the kernel will be created in <strong>arch/x86/boot/</strong> as
        <strong>bzImage</strong> file.
      </p>

      <p>Move kernel to our main directory:</p>
      <pre><code>mv arch/x86/boot/bzImage ../
cd ..</code></pre>

      <h2 id="toolset">Toolset</h2>
      <p>
        Without tools kernel will just boot and you will not be able to do
        anything. One of the most popular lightweight tools is
        <a href="https://busybox.net/">BusyBox</a>. It replaces the standard GNU
        utilities with way smaller but still functional alternatives, perfect
        for embedded needs.
      </p>
      <p>
        Get the <strong>1.36.1</strong> version from
        <a href="https://busybox.net/downloads/">busybox.net</a>
        or
        <a href="https://github.com/mirror/busybox/releases/tag/1_36_1"
          >Github mirror</a
        >. Download the file, extract it, and change directory:
      </p>
      <blockquote>Remember to be in the working directory.</blockquote>
      <pre><code>wget https://github.com/mirror/busybox/archive/refs/tags/1_36_1.tar.gz
tar xzvf 1_36_1.tar.gz
cd busybox-1_36_1/</code></pre>
      <p>As with kernel you need to create starting configuration:</p>
      <pre><code>make ARCH=x86 allnoconfig</code></pre>

      <blockquote>
        You may skip this following fix if you are building on Debian/Fedora
      </blockquote>
      <p>Fix for ArchLinux based distributions:</p>
      <pre><code>sed -i 's/main() {}/int main() {}/' scripts/kconfig/lxdialog/check-lxdialog.sh</code></pre>

      <blockquote>
        Now the fun part. You need to choose what tools you want. Each menu
        entry will show how much more KB will be taken if you choose it. So
        choose it wisely :) For the first time use my selection.
      </blockquote>
      <p>Run the configurator:</p>
      <pre><code>make ARCH=x86 menuconfig</code></pre>
      <p>Choose those:</p>
      <ul>
        <li>
          Settings
          <ul>
            <li>Build static binary (no shared libs)</li>
            <li>
              Support files
              <ul>
                <li>2GB</li>
              </ul>
            </li>
          </ul>
        </li>
        <li>
          Coreutils
          <ul>
            <li>cat</li>
            <li>cp</li>
            <li>df</li>
            <li>echo</li>
            <li>ls</li>
            <li>mv</li>
            <li>rm</li>
            <li>sync</li>
            <li>test</li>
          </ul>
        </li>
        <li>
          Console Utilities
          <ul>
            <li>clear</li>
          </ul>
        </li>
        <li>
          Editors
          <ul>
            <li>vi</li>
          </ul>
        </li>
        <li>
          Init Utilities
          <ul>
            <li>init</li>
            <li>uncheck everything else (inside init)</li>
          </ul>
        </li>
        <li>
          Linux System Utilities
          <ul>
            <li>mdev</li>
            <li>mount (just -o flag, rest off)</li>
            <li>umount</li>
          </ul>
        </li>
        <li>
          Shells
          <ul>
            <li>Choose alias as (ash)</li>
            <li>ash</li>
            <li>Optimize for size instead of speed</li>
            <li>Alias support</li>
            <li>Help support</li>
          </ul>
        </li>
        <li>
          Miscellaneous
          <ul>
            <li>uncheck readahead</li>
          </ul>
        </li>
      </ul>
      <p>Now exit with save config.</p>

      <h3>Cross Compiler Setup</h3>
      <blockquote>
        Our target system needs to be 32-bit. To compile it on 64-bit system we
        need a cross compiler. You can setup this by hand in the menuconfig or
        just copy and paste those four lines.
      </blockquote>
      <p>Setup paths:</p>
      <pre><code>sed -i "s|.*CONFIG_CROSS_COMPILER_PREFIX.*|CONFIG_CROSS_COMPILER_PREFIX="\"${BASE}"i486-linux-musl-cross/bin/i486-linux-musl-\"|" .config

sed -i "s|.*CONFIG_SYSROOT.*|CONFIG_SYSROOT=\""${BASE}"i486-linux-musl-cross\"|" .config

sed -i "s|.*CONFIG_EXTRA_CFLAGS.*|CONFIG_EXTRA_CFLAGS=-I$BASE/i486-linux-musl-cross/include|" .config

sed -i "s|.*CONFIG_EXTRA_LDFLAGS.*|CONFIG_EXTRA_LDFLAGS=-L$BASE/i486-linux-musl-cross/lib|" .config</code></pre>
      <h3>Compile BusyBox</h3>
      <p>Build tools and create base filesystem ("install"):</p>
      <pre><code>make ARCH=x86 -j$(nproc) && make ARCH=x86 install</code></pre>
      <p>
        This will create a filesystem with all the files at
        <strong>_install/</strong>. Move it to our main directory. I like to
        rename it to.
      </p>
      <pre><code>mv _install ../filesystem
cd ../filesystem</code></pre>

      <h2 id="filesystem">Filesystem</h2>
      <p>
        You got kernel and basic tools but the system still needs some
        additional directory structure.
      </p>
      <blockquote>
        This created minimum viable directory structure for satisfying the basic
        requirements of a Linux system.
      </blockquote>
      <blockquote>Remember to be in the filesystem/ directory.</blockquote>
      <pre><code>mkdir -pv {dev,proc,etc/init.d,sys,tmp,home}
sudo mknod dev/console c 5 1
sudo mknod dev/null c 1 3</code></pre>
      <p>
        Next step is to add minimum configuration files. First one is a welcome
        message that will be shown after booting.
      </p>
      <blockquote>
        Here is the first real opportunity to go wild and make this your own
        signature.
      </blockquote>
      <pre><code>cat >> welcome << EOF
Your welome message or ASCII art.
EOF</code></pre>
      <p>Or download my welcome file.</p>
      <pre><code>wget https://krzysztofjankowski.com/floppinux/downloads/0.3.0/welcome</code></pre>
      <p>It looks like that:</p>
      <pre><code>$ cat welcome

                _________________
               /_/ FLOPPINUX  /_/;
              / ' boot disk  ' //
             / '------------' //
            /   .--------.   //
           /   /         /  //
          .___/_________/__//   1440KiB
          '===\_________\=='   3.5"

_______FLOPPINUX_V_0.3.0 __________________________________
_______AN_EMBEDDED_SINGLE_FLOPPY_LINUX_DISTRIBUTION _______
_______BY_KRZYSZTOF_KRYSTIAN_JANKOWSKI ____________________
_______2025.10 ____________________________________________</code></pre>

      <blockquote>
        Back to serious stuff. Inittab tells the system what to do in critical
        states like starting, exiting and restarting. It points to the
        initialization script rc that is the first thing that our OS will run
        before dropping into the shell.
      </blockquote>
      <p>Create an inittab file:</p>
      <pre><code>cat >> etc/inittab << EOF
::sysinit:/etc/init.d/rc
::askfirst:/bin/sh
::restart:/sbin/init
::ctrlaltdel:/sbin/reboot
::shutdown:/bin/umount -a -r
EOF</code></pre>
      <p>And the init rc script:</p>
      <pre><code>cat >> etc/init.d/rc << EOF
#!/bin/sh
mount -t proc none /proc
mount -t sysfs none /sys
mdev -s
ln -s /proc/mounts /etc/mtab
mkdir -p /mnt /home
mount -t msdos -o rw /dev/fd0 /mnt
mkdir -p /mnt/data
mount --bind /mnt/data /home
clear
cat welcome
cd /home
/bin/sh
EOF</code></pre>
      <p>Make the script executable and owner of all files to root:</p>
      <pre><code>chmod +x etc/init.d/rc
sudo chown -R root:root .</code></pre>
      <p>Compress this directory into one file:</p>
      <pre><code>find . | cpio -H newc -o | xz --check=crc32 --lzma2=dict=512KiB -e > ../rootfs.cpio.xz
  cd ..</code></pre>
      <p>Create booting configuration.</p>
      <blockquote>
        Another place to tweak parameters for your variant. Text after SAY is
        what will be displayed on the screen as first, usualy a name of the OS.
      </blockquote>
      <blockquote>
        The tsc=unstable is useful on some (real) computers to get rid of
        randomly shown warnings about Time Stamp Counter.
      </blockquote>
      <blockquote>Remember to be in the working directory.</blockquote>
      <pre><code>cat >> syslinux.cfg << EOF
DEFAULT floppinux
LABEL floppinux
SAY [ BOOTING FLOPPINUX VERSION 0.3.0 ]
KERNEL bzImage
INITRD rootfs.cpio.xz
APPEND root=/dev/ram rdinit=/etc/init.d/rc console=tty0 tsc=unstable
EOF</code></pre>
      <p>Make it executable:</p>
      <pre><code>chmod +x syslinux.cfg</code></pre>

      <p>Create sample file</p>
      <blockquote>
        To make the system a little bit more user friendly I like to have a
        sample file that user will be able to read and edit. You can put
        anything you want in it. A simple help would be also a good idea to
        include.
      </blockquote>
      <pre><code>cat >> hello.txt << EOF
Hello, FLOPPINUX user!
EOF</code></pre>

      <p>Filesystem is ready. Final step is to put this all on a floppy!</p>

      <h2 id="boot-image">Boot Image</h2>
      <p>
        First we need an empty file in exact size of a floppy disk. Then format
        and make it bootable.
      </p>

      <p>Create empty floppy image:</p>
      <pre><code>dd if=/dev/zero of=floppinux.img bs=1k count=1440</code></pre>
      <p>Format it and create bootloader:</p>
      <pre><code>mkdosfs -n FLOPPINUX floppinux.img
syslinux --install floppinux.img</code></pre>

      <p>Mount it and copy syslinux, kernel, and filesystem onto it:</p>
      <pre><code>sudo mount -o loop floppinux.img /mnt
sudo mkdir /mnt/data
sudo cp hello.txt /mnt/data/
sudo cp bzImage /mnt
sudo cp rootfs.cpio.xz /mnt
sudo cp syslinux.cfg /mnt
sudo umount /mnt</code></pre>
      <p>Done!</p>

      <h3>Test in emulator</h3>
      <p>It's good to test before wasting time for the real floppy to burn.</p>
      <p>Boot the new OS in qemu:</p>
      <pre><code>qemu-system-i386 -fda floppinux.img -m 20M -cpu 486</code></pre>
      <p>
        If it worked that means You have successfully created your own
        distribution! Congratulations!
      </p>

      <p>
        The <strong>floppinux.img</strong> image is ready to burn onto a floppy
        and boot on real hardware!
      </p>

      <h2 id="floppy-disk">Floppy Disk</h2>
      <h3>&lt;!&gt; Important &lt;!&gt;</h3>
      <p>
        Change XXX to floppy drive name in your system. In my case it is
        <strong>sdb</strong>. Choosing wrongly will NUKE YOUR PARTITION and
        REMOVE all of your files! Think twice. Or use some GUI application for
        that.
      </p>
      <pre><code>sudo dd if=floppinux.img of=/dev/XXX bs=512 conv=notrunc,sync,fsync oflag=direct status=progress</code></pre>
      <p>After 5 minutes I got freshly burned floppy.</p>

      <h2 id="summary">Summary</h2>
      <ul>
        <li>FLOPPINUX: 0.3.0</li>
        <li>Linux Kernel: 6.14.11</li>
        <li>Busybox: 1.36.1</li>
        <li>Image size: 1440KiB / 1.44MiB</li>
        <li>Kernel size: 868KiB (bzImage)</li>
        <li>Tools: 138KiB (rootfs.cpio.xz)</li>
        <li>Free space left (df -h): 264KiB</li>
      </ul>

      <h3>System Tools</h3>
      <ul>
        <li>
          File &amp; Directory Manipulation
          <ul>
            <li>cat - display file contents</li>
            <li>cp - copy files and directories</li>
            <li>mv - move/rename files and directories</li>
            <li>rm - remove files and directories</li>
            <li>ls - list directory contents</li>
          </ul>
        </li>
        <li>
          System Information &amp; Management
          <ul>
            <li>df - display filesystem disk space usage</li>
            <li>mount - mount filesystems</li>
            <li>umount - unmount filesystems</li>
            <li>sync - force write of buffered data to disk</li>
          </ul>
        </li>
        <li>
          Text Processing &amp; Output
          <ul>
            <li>echo - display text output</li>
            <li>more - page through text output</li>
          </ul>
        </li>
        <li>
          Utilities
          <ul>
            <li>ln - create links between files</li>
            <li>clear - clear terminal screen</li>
            <li>test - evaluate conditional expressions</li>
          </ul>
        </li>
      </ul>

      <h3>Applications</h3>
      <ul>
        <li>vi - text editor</li>
      </ul>

      <h2 id="download">Download</h2>
      <ul>
        <li>
          FLOPPINUX 0.3.0
          <a href="/floppinux/downloads/0.3.0/floppinux.img"
            >Floppy Image 1.44MB</a
          >
          (<a
            href="https://github.com/w84death/floppinux/blob/main/floppinux.img"
            >GitHub Mirror</a
          >)
        </li>
      </ul>
    </main>
    <footer>
      <hr />
      <pre>

                         _________________
                        /_/ FLOPPINUX  /_/;
                       / ' boot disk  ' //
                      / '------------' //
                     /   .--------.   //
                    /   /         /  //
                   .___/_________/__//   1440KiB
                   '===\_________\=='   3.5&quot;


                Now go and make something fun with it!



</pre
      >
      <nav><a href="/floppinux/">back to home</a></nav>
    </footer>
  </body>
</html>
